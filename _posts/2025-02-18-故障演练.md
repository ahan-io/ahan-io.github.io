---
layout: post
title: "稳定性——故障演练"
author:       "Ahan"
date: 2025-02-18 00:00:00
header-img: "img/post-bg-2015.jpg"
header-style: text
catalog:      true
tags:
    - Architecture
    - Stability
---
故障演练是一种通过模拟生产环境中可能出现的故障，检验和提升系统可靠性、稳定性以及应急响应能力的实践活动。

# **目的**

1. **提升系统韧性**
    - 帮助团队提前发现系统潜在的脆弱点。例如，在分布式系统中，某个节点故障可能导致服务不可用。通过故障演练，可以确定系统在这种情况下是否能够自动切换到其他节点，或者是否有足够的冗余来保证服务的持续提供。
    - 增强系统对各种故障场景的容忍度，包括硬件故障（如服务器宕机、存储设备损坏）、软件故障（如程序崩溃、数据库死锁）、网络故障（如网络中断、高延迟）等。
2. **检验应急响应能力**
    - 测试团队在面对故障时的响应速度和处理流程的有效性。例如，当发生故障时，运维团队是否能够及时收到警报，开发团队是否能够迅速定位问题并采取修复措施。
    - 验证应急方案（如灾难恢复计划、故障切换策略）的可行性和准确性，确保在真正的故障发生时，这些方案能够按照预期执行。
3. **增强团队协作和沟通**
    - 故障演练涉及多个部门，如开发、运维、测试等。在演练过程中，团队成员需要密切协作，这有助于打破部门之间的沟通障碍，提高团队整体的协同工作能力。
    - 明确各团队在故障处理中的角色和职责，避免在实际故障发生时出现职责不清而导致的混乱局面。

# **演练流程**

![故障演练.drawio.png](https://ahan-io.notion.site/image/attachment%3A912241ff-213b-4499-854a-838402f369ba%3A%E6%95%85%E9%9A%9C%E6%BC%94%E7%BB%83.drawio.png?table=block&id=19deda9f-236a-8065-96f1-ce6967d2ce37&spaceId=3841c813-6aff-406c-8c94-6fa3c0018b15&width=1400&userId=&cache=v2)

1. **规划阶段**
    - **确定演练目标**：明确要测试的系统功能、性能指标以及想要提升的应急响应能力。例如，目标可能是测试系统在遭受 大规模 Kubernetes 集群故障后的恢复能力，或者验证新的故障转移机制是否有效。
    - **选择故障场景**：根据系统的架构、历史故障数据和风险评估来选择模拟的故障场景。这些场景可以包括硬件故障（如模拟服务器磁盘损坏）、软件故障（如Kubernetes 证书全丢失场景，NAS server 超冗余故障）、网络故障（如模拟网络拥塞或部分网络中断）、安全漏洞（如模拟 SQL 注入攻击）等。
    - **制定演练计划**：包括演练的时间、参与人员、沟通渠道、应急响应步骤和预期的结果等。例如，计划中应明确在模拟故障发生后，运维人员应在多长时间内开始进行故障排查，开发人员应在何时介入提供技术支持等。
2. **准备阶段**
    - **搭建演练环境**：可以是在生产环境的副本（如测试环境或预生产环境）中进行，以尽量模拟真实的生产环境。确保演练环境与生产环境具有相似的配置、数据和负载情况。
    - **准备演练工具**：例如故障注入工具，用于模拟各种故障场景；监控工具，用于实时监测系统在故障期间的性能和状态；通信工具，用于团队成员之间的沟通和协作。
    - **培训参与人员**：让所有参与演练的人员熟悉演练计划、各自的职责和应急响应流程。对他们进行必要的技术培训，如如何使用故障注入工具、如何解读监控数据等。
3. **执行阶段**
    - **注入故障**：按照预定的故障场景，使用故障注入工具在演练环境中触发故障。例如，通过模拟网络延迟来测试系统对网络性能下降的反应，或者通过关闭某个服务来观察系统的容错能力。
    - **监控和记录**：在故障发生期间，利用监控工具密切关注系统的各项指标，如 CPU 使用率、内存占用、服务响应时间、错误率等。同时，记录系统的行为和团队的响应过程，包括采取的措施、时间节点、沟通内容等。
    - **团队响应**：各团队按照演练计划和应急响应流程开展工作。运维团队负责监控系统状态、排查故障原因；开发团队准备修复代码或提供技术支持；测试团队协助验证修复后的系统是否恢复正常。
    - **业务止损**：研发人员或 SRE 通过各种手段让业务恢复运行。
    - **应急响应评估**：对团队的应急响应过程进行评估，包括响应时间、定位时间、止损时间。
4. **评估阶段**
    - **系统性能评估**：分析在故障期间和故障恢复后的系统性能数据，评估系统是否达到了预期的性能指标。例如，服务是否可以满足5-15-30的目标（5分钟发现、15分钟定位、30分钟恢复）。
    - **总结和复盘**：根据评估结果，总结演练过程中的经验教训。例如告警是否有效、采取的措施是否有效、团队之间的协作是否顺畅等。针对发现的问题，制定改进措施，如优化系统架构、完善应急响应流程、加强团队培训等。这些改进措施将应用于下一次的故障演练或实际的生产环境中。

故障演练是保障系统高可靠性和稳定性的重要手段，对于复杂的软件系统和关键业务系统尤其具有重要的价值。